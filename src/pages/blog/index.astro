---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

const allPosts = await getCollection('blog');
const sortedPosts = allPosts.sort((a, b) => 
  new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);

const title = 'Blog | Data Engineering & Web Development';
const description = 'Artículos sobre Data Engineering, Cloud, Arquitectura de Datos y Web Development con Astro.';
---

<Layout title={title} description={description}>
  <main>
    <!-- Header -->
    <section class="pt-32 pb-20 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-blue-50 to-white dark:from-gray-800 dark:to-gray-900">
      <div class="max-w-6xl mx-auto text-center">
        <h1 class="text-5xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Blog</h1>
        <p class="text-xl text-gray-600 dark:text-gray-400">Data Engineering, Cloud Architecture & Web Development</p>
      </div>
    </section>

    <!-- Posts Grid -->
    <section class="py-20 px-4 sm:px-6 lg:px-8 bg-white dark:bg-gray-900">
      <div class="max-w-6xl mx-auto">
        <!-- All Articles Grid -->
        <h2 class="text-4xl font-bold mb-12 text-center text-gray-900 dark:text-white">Todos los Artículos</h2>
        
        {sortedPosts.length > 0 && (
          <>
            <!-- Featured First Article -->
            <div class="mb-16">
              {sortedPosts.slice(0, 1).map(post => (
                <article class="group bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition overflow-hidden border border-gray-200 dark:border-gray-700">
                  <div class="p-8">
                    <div class="overflow-hidden rounded-2xl mb-6">
                      <img
                        src={post.data.heroImage ?? 'https://placehold.co/900x500?text=Camilo+Blog'}
                        alt={post.data.title}
                        loading="eager"
                        fetchpriority="high"
                        decoding="async"
                        sizes="(min-width: 1024px) 900px, 100vw"
                        class="w-full h-64 md:h-80 object-cover transition duration-300 group-hover:scale-[1.02]"
                      />
                    </div>
                    <div class="flex items-center gap-4 mb-4">
                      <span class="text-sm font-bold text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-900 px-4 py-2 rounded-full">
                        {post.data.category}
                      </span>
                      <span class="text-sm text-gray-500 dark:text-gray-400">{post.data.readingTime} min lectura</span>
                    </div>

                    <h3 class="text-3xl font-bold mb-4 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition text-gray-900 dark:text-white">
                      <a href={`/blog/${post.slug}`}>
                        {post.data.title}
                      </a>
                    </h3>

                    <p class="text-gray-600 dark:text-gray-400 text-lg mb-6 line-clamp-3">
                      {post.data.description}
                    </p>

                    {post.data.tags && (
                      <div class="flex flex-wrap gap-2 mb-6">
                        {post.data.tags.slice(0, 5).map(tag => (
                          <span class="text-sm bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-3 py-1 rounded">#{tag}</span>
                        ))}
                      </div>
                    )}

                    <div class="flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700">
                      <time class="text-sm text-gray-500 dark:text-gray-400" dateTime={post.data.pubDate.toISOString()}>
                        {post.data.pubDate.toLocaleDateString('es-CO', { year: 'numeric', month: 'long', day: 'numeric' })}
                      </time>
                      <a 
                        href={`/blog/${post.slug}`}
                        class="text-blue-600 dark:text-blue-400 font-bold hover:text-blue-700 dark:hover:text-blue-300 transition text-lg"
                      >
                        Leer artículo →
                      </a>
                    </div>
                  </div>
                </article>
              ))}
            </div>

            <!-- Next 5 Articles Grid -->
            {sortedPosts.length > 1 && (
              <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
                {sortedPosts.slice(1, 6).map(post => (
                  <article class="group bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col h-full">
                    <div class="overflow-hidden rounded-xl">
                      <img
                        src={post.data.heroImage ?? 'https://placehold.co/700x420?text=Camilo+Blog'}
                        alt={post.data.title}
                        loading="lazy"
                        decoding="async"
                        sizes="(min-width: 1024px) 420px, 100vw"
                        class="w-full h-48 object-cover transition duration-300 group-hover:scale-[1.02]"
                      />
                    </div>
                    <div class="p-6 flex flex-col h-full">
                      <div class="flex items-center justify-between mb-3">
                        <span class="text-xs font-bold text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-900 px-3 py-1 rounded-full">
                          {post.data.category}
                        </span>
                        <span class="text-xs text-gray-500 dark:text-gray-400">{post.data.readingTime} min</span>
                      </div>

                      <h3 class="text-xl font-bold mb-3 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition text-gray-900 dark:text-white line-clamp-2">
                        <a href={`/blog/${post.slug}`}>
                          {post.data.title}
                        </a>
                      </h3>

                      <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-3 flex-grow">
                        {post.data.description}
                      </p>

                      {post.data.tags && (
                        <div class="flex flex-wrap gap-2 mb-4">
                          {post.data.tags.slice(0, 3).map(tag => (
                            <span class="text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded">#{tag}</span>
                          ))}
                        </div>
                      )}

                      <div class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700 mt-auto">
                        <time class="text-xs text-gray-500 dark:text-gray-400" dateTime={post.data.pubDate.toISOString()}>
                          {post.data.pubDate.toLocaleDateString('es-CO', { year: 'numeric', month: 'short', day: 'numeric' })}
                        </time>
                        <a 
                          href={`/blog/${post.slug}`}
                          class="text-blue-600 dark:text-blue-400 font-semibold hover:text-blue-700 dark:hover:text-blue-300 transition text-sm"
                        >
                          Leer →
                        </a>
                      </div>
                    </div>
                  </article>
                ))}
              </div>
            )}

            <!-- Remaining Articles Grid -->
            {sortedPosts.length > 6 && (
              <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                {sortedPosts.slice(6).map(post => (
                  <article class="group bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col h-full">
                    <div class="overflow-hidden rounded-xl">
                      <img
                        src={post.data.heroImage ?? 'https://placehold.co/700x420?text=Camilo+Blog'}
                        alt={post.data.title}
                        loading="lazy"
                        decoding="async"
                        sizes="(min-width: 1024px) 420px, 100vw"
                        class="w-full h-48 object-cover transition duration-300 group-hover:scale-[1.02]"
                      />
                    </div>
                    <div class="p-6 flex flex-col h-full">
                      <div class="flex items-center justify-between mb-3">
                        <span class="text-xs font-bold text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-900 px-3 py-1 rounded-full">
                          {post.data.category}
                        </span>
                        <span class="text-xs text-gray-500 dark:text-gray-400">{post.data.readingTime} min</span>
                      </div>

                      <h3 class="text-xl font-bold mb-3 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition text-gray-900 dark:text-white line-clamp-2">
                        <a href={`/blog/${post.slug}`}>
                          {post.data.title}
                        </a>
                      </h3>

                      <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-3 flex-grow">
                        {post.data.description}
                      </p>

                      {post.data.tags && (
                        <div class="flex flex-wrap gap-2 mb-4">
                          {post.data.tags.slice(0, 3).map(tag => (
                            <span class="text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded">#{tag}</span>
                          ))}
                        </div>
                      )}

                      <div class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700 mt-auto">
                        <time class="text-xs text-gray-500 dark:text-gray-400" dateTime={post.data.pubDate.toISOString()}>
                          {post.data.pubDate.toLocaleDateString('es-CO', { year: 'numeric', month: 'short', day: 'numeric' })}
                        </time>
                        <a 
                          href={`/blog/${post.slug}`}
                          class="text-blue-600 dark:text-blue-400 font-semibold hover:text-blue-700 dark:hover:text-blue-300 transition text-sm"
                        >
                          Leer →
                        </a>
                      </div>
                    </div>
                  </article>
                ))}
              </div>
            )}
          </>
        )}

        <!-- Stats -->
        <div class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-800">
          <div class="grid md:grid-cols-3 gap-8 text-center">
            <div>
              <div class="text-4xl font-bold text-blue-600 dark:text-blue-400 mb-2">{sortedPosts.length}</div>
              <p class="text-gray-600 dark:text-gray-400">Artículos publicados</p>
            </div>
            <div>
              <div class="text-4xl font-bold text-blue-600 dark:text-blue-400 mb-2">
                {Math.round(sortedPosts.reduce((acc, p) => acc + (p.data.readingTime || 0), 0) / sortedPosts.length)}
              </div>
              <p class="text-gray-600 dark:text-gray-400">Minutos promedio lectura</p>
            </div>
            <div>
              <div class="text-4xl font-bold text-blue-600 dark:text-blue-400 mb-2">
                {new Set(sortedPosts.flatMap(p => p.data.tags || [])).size}
              </div>
              <p class="text-gray-600 dark:text-gray-400">Topics cubiertos</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Newsletter CTA -->
    <section class="py-16 px-4 sm:px-6 lg:px-8 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700">
      <div class="max-w-2xl mx-auto text-center">
        <h2 class="text-3xl font-bold mb-4 text-gray-900 dark:text-white">
          Suscríbete a Nuevos Artículos
        </h2>
        <p class="text-gray-600 dark:text-gray-300 mb-6">
          Recibe notificaciones cuando publiquemos artículos sobre Data Engineering y Web Development.
        </p>
        <form class="flex gap-2 flex-col sm:flex-row">
          <input 
            type="email" 
            placeholder="tu@email.com" 
            required
            class="flex-1 px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <button 
            type="submit"
            class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition"
          >
            Suscribir
          </button>
        </form>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">
          Sin spam. Solo contenido de valor.
        </p>
      </div>
    </section>
  </main>
</Layout>
